<a name="---"></a><!---
---
示範：標題：「Azure 網路安全性群組 (NSG)」學習路徑/課程模組/單元：「學習路徑：描述 Microsoft 安全性解決方案的功能；課程模組 1：描述 Azure 中的基本安全性功能；單元 6：描述 Azure 網路安全性群組」
---
--->

# <a name="demo-azure-network-security-groups-nsgs"></a>示範：Azure 網路安全性群組 (Network Security Group, NSG)

此示範對應至下列 Learn 內容：

- 學習路徑：描述 Microsoft 安全性解決方案的功能
- 課程模組：描述 Azure 中的基本安全性功能
- 單元：描述 Azure 網路安全性群組

## <a name="demo-scenario"></a>示範案例

在本示範中，您將探索 Azure 中網路安全性群組的功能，並將 NSG 套用至預先建立的虛擬機器。 首先，您會簡短顯示授權實驗室託管服務提供者 (ALH) 預先建立的 VM 相關資訊。 接著，您會示範建立 NSG 的程序、顯示預設輸入和輸出規則、建立新的 RDP 規則以允許連線至 VM，然後加以測試。

### <a name="demo-part-1"></a>示範第 1 部分

在這個部分中，您會檢視與為了用於本實驗而建立的 VM 相關聯的一些參數。

1. 開啟 Microsoft Edge。  在網址列輸入 **portal.azure.com**。

1. 登入管理員認證。
    1. 在 [登入] 視窗中，輸入實驗室託管供者所提供的使用者名稱，然後選取 [下一步]。
    1. 輸入應由您的實驗室託管提供者提供的管理員密碼。 選取 [登入]。
    1. 出現提示要求您保持登入時，請選取 [是]。

1. 在頁面頂端的 [Azure 服務] 之下，選取 [虛擬機器]。  如果沒看到其列出，則在搜尋方塊中，於頁面頂部 Microsoft Azure 旁邊的藍色列中，輸入**虛擬機器**，然後從搜尋結果中選取 [虛擬機器]。

1. 從虛擬機器頁面中，選取所列的 VM [SC900-WinVM]。

1. 您現在位於 SC900-WinVM 頁面。  請注意 VM 所在的資源群組名稱 (LabsSC900)。

1. 請選取頁面上方的**連線**，接著在下拉式功能表選取 **RDP**。 請注意，連接埠的必要條件未受到滿足。  為滿足必要條件，必須設定輸入網路安全性規則，其目的地連接埠為 3389 且由 RDP 使用。  您將會在下一個工作中執行該作業，也就是建立網路安全性群組時。

1. 在左側導覽面板中，選取 [網路]。  
    1. 預設檢視用於輸入連接埠規則。  請注意，此 VM 的網路介面未設定網路安全性群組。  如果您選取 [輸出連接埠規則]，也是如此。
    1. 選取 [網路介面] 旁的 [有效安全性規則]。  請注意，它會顯示「網路介面未與任何網路安全性群組或應用程式安全性群組建立關聯」。
1. 讓此瀏覽器索引標籤保持開啟。

### <a name="demo-part-2"></a>示範第 2 部分

在這個部分中，建立網路安全性群組、將 VM 的網路介面指派給 NSG，以及為 RDP 流量建立新的輸入規則。

1. 在瀏覽器上開啟 [SC900-WinVM – Microsoft Azure] 索引標籤。

1. 在頁面頂端的藍色搜尋列中，輸入**網路安全性群組**。 從結果中，選取 [網路安全性群組] (請勿選取 [傳統網路安全性群組])。

1. 從網路安全性群組頁面的頂部，選取 **+ 建立**。

1. 在建立網路安全性群組頁面的基本索引標籤上，指定下列設定：
    1. 訂用帳戶：保留預設值 (這是授權實驗室託管服務提供者所提供的 Azure 訂用帳戶)
    1. 資源群組：**LabsSC900**
    1. 名稱：**NSG-SC900**
    1. 區域：保留預設值。
    1. 請選取**檢閱 + 建立**然後選取**建立**。

1. 部署完成後，請選取 [前往資源]。

1. 在頁面頂端的 [基本資訊] 底下，您會看到您所建立 NSG 的一些基本資訊。  請注意兩點：沒有任何「自訂」安全性規則，也沒有與此 NSG 相關聯的子網路和網路介面。  雖然沒有自訂安全性規則，但每個 NSG 都包含預設的輸入和輸出規則，如頁面上所示。  檢閱輸入和輸出規則。 預設輸入規則會拒絕不是來自虛擬網路或 Azure 負載平衡器的所有輸入流量。  輸出規則會拒絕虛擬網路之間流量和對網際網路的輸出流量以外的所有輸出流量。

1. 從 NSG-SC900 頁面的左側導覽窗格中，選取 [設定] 之下的 [網路介面]。
    1. 選取 [關聯]。
    1. 在選取網路介面關聯的欄位中，選取**向下箭號**、選取 [sc900-winvmXXX]，然後選取視窗底部的 [確定]。 一旦介面與 NSG 關聯，它就會顯示在清單上。

1. 在左側的瀏覽窗格中，選取 [輸入安全性規則]。 預設的輸入規則會拒絕非來自虛擬網路或 Azure 負載平衡器的所有輸入流量，因此您必須設定規則以允許輸入 RDP 流量 (連接埠 3389 的流量)。 請記得，您無法移除預設規則，但可以建立優先順序更高的規則來加以覆寫。

1. 從頁面頂端選取 [新增]。 在 [新增輸入安全性規則] 的視窗中，指定下列設定：
    1. 來源：**任何**
    1. 來源連接埠範圍： **\***
    1. 目的地：**任何**
    1. 服務：**RDP**
    1. 動作：**允許**
    1. 優先順序：**1000**；請注意：編號較小的規則優先順序較高，應首先進行處理。
    1. 名稱：保留預設名稱，或建立自己的描述性名稱。
    1. 請注意頁面底部的警告符號。  我們只使用 RDP 進行測試，以及示範 NSG 的功能。
    1. 選取 [新增]

1. 規則佈建完成後，即會出現於輸入規則的清單中 (您可能需要重新整理畫面)。 在新增的規則上，您會看到警告符號。  如上所述，我們只使用 RDP 進行測試，以及示範 NSG 的功能。

### <a name="demo-part-3"></a>示範第 3 部分

建立 NSG 並與您的 VM 和所建立 RDP 規則建立關聯後，您會藉由測試與 VM 的 RDP 連線來顯示 NSG 的影響。

1. 在瀏覽器上開啟 [SC900-WinVM – Microsoft Azure] 索引標籤。 如果您先前關閉了瀏覽器索引標籤，請選取頁面頂端的藍色搜尋列並選取虛擬機器，然後選取 VM **SC900-WinVM**。

1. 透過驗證是否可以使用 RDP 連線至 VM 來測試輸入規則。
    1. 在左側導覽面板中，選取 [連線]****。
    1. 驗證 IP 位址是否設定為公共 IP 位址，保留預設連接埠編號並選取**下載 DRP 檔案**。
    1. **開啟**已下載的檔案並選取**連線**。
    1. 系統會提示您提供認證。 輸入您在建立 VM 時所使用的使用者名稱和密碼。  如果提示輸入認證的視窗要求輸入 PIN，請選取**更多選取**，然後選取**使用其他帳戶**。
    1. 遠端桌面連線視窗開啟，顯示無法驗證遠端電腦的身分識別。 仍要繼續連線？ 選取 [是]  。
    1. 您現在已連線至 VM。 向學員強調，在這種情況下，您能夠連線至 VM，因為您建立的輸入流量規則允許透過 RDP 向 VM 傳送輸入流量。

1. 因為您已經在 VM 中，所以可顯示對網際網路的輸出網際網路連線能力，這是由其中一個預設輸出規則所啟用。
    1. 在 VM 上，選取 [Microsoft Edge] 以開啟瀏覽器。  因為這是您第一次開啟 Microsoft Edge，您可能會看到快顯視窗、選取 [不使用您的資料開始]，接著選取 [不使用此資料繼續]，然後選取 [確認並開始瀏覽]。
    1. 在瀏覽器網址列中輸入 **www.bing.com**，確認您可以連線至搜尋引擎。
    1. 確認您可存取 www.bing.com 之後，請關閉 VM 中的瀏覽器視窗，但是讓 VM 保持運作。

1. 選取藍色索引標籤中的底線 **_** 以顯示 VM 的 IP 位址，藉此將 VM 最小化。 這可讓您回到 [SC900-WinVM | 連線] 頁面。  

### <a name="optional-demo-part-4"></a>(選擇性) 示範第 4 部分

如果課堂時間允許，您可以建立輸出 NSG 規則來封鎖來自 VM 的輸出網際網路流量。

1. 在左側導覽面板中，選取 [網路]。 您應該位於 [SC900-WinVM | 網路] 頁面。

1. 請選取**輸出連接埠規則**索引標籤。您將會看到預設輸出規則。  請注意預設規則「AllowInternetOutBound」。 此規則允許所有輸出網際網路流量。 您無法移除預設規則，但可以建立優先順序更高的規則來覆寫。 在頁面的右側，請選取**新增輸出連接埠規則**。

1. 在 [新增輸出安全性規則] 頁面上，指定下列設定：
    1. 來源：**任何**
    1. 來源連接埠範圍： **\***
    1. 目的地：**服務標籤**
    1. 目的地服務標籤：**網際網路**
    1. 服務：**自訂** (保留預設值)
    1. 目的地連接埠範圍：* (請確保在目的地連接埠範圍欄位中輸入星號)
    1. 通訊協定:**任何**
    1. 動作：**拒絕**
    1. 優先順序：**1000**
    1. 名稱：保留預設名稱，或建立自己的描述性名稱。
    1. 選取 [新增]

1. 建置規則後，它將出現在輸入規則清單中。  雖然出現在清單上，仍需要數分鐘才能生效 (等待數分鐘，再繼續下一個步驟)。  

1. 返回您的 VM (VM 圖示應該顯示在頁面底部的工作列上)。

1. 開啟 VM 中的 Microsoft Edge 瀏覽器，然後輸入 **www.bing.com**。 該頁面不應顯示。  請注意：如果您能夠連線至網際網路並驗證輸出規則的所有參數都已正確設定，則可能是因為該規則需要幾分鐘才會生效。  關閉瀏覽器，等待數幾分鐘後，然後重試。  注意：實驗室環境中的 Azure 訂用帳戶可能會經歷比正常還要長的延遲。

1. 透過選取顯示 IP 位址的頁面頂部中心的 **X**，關閉遠端桌面連線。  快顯視窗隨即出現，指出您的遠端工作階段將會中斷連線。 選取 [確定]。

1. 關閉所有已開啟的瀏覽器索引標籤。

1. 如果 VM 僅用於示範或測試目的，一般最佳做法是停止或終止 VM，以避免產生成本。 不過，在此情況下，請勿終止 VM，因為在示範適用於雲端的 Microsoft Defender 時，其有助於提供雲端安全性狀態管理資料。  當實驗室取消時，VM 將會終止。

#### <a name="review"></a>檢閱

在本示範中，您展示了與 NSG 關聯的資訊和設定，包含將介面與 NSG 關聯的流程，並展示預設輸入和輸出規則，最後為建立新規則的步驟。
